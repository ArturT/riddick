<!DOCTYPE html>
<html lang="en">
<head>
  <title><%= t 'head.title', 'Welcome to Riddick!' %></title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!--[if IE ]><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><![endif]-->
  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
  <![endif]-->
  <link href="<%= url 'stylesheets/vendor/bootstrap.css' %>" media="all" rel="stylesheet" type="text/css">
  <link href="<%= url 'stylesheets/vendor/chosen.css' %>" media="all" rel="stylesheet" type="text/css">
  <link href="<%= url 'stylesheets/riddick.css' %>" media="all" rel="stylesheet" type="text/css">
</head>

<body>
  <div class="container">
    <div class="navbar">
      <div class="navbar-inner">
        <a href="<%= root_url %>" class="brand"><%= t 'nav.brand', 'Riddick' %></a>
        <ul class="nav">
          <li class="<%= 'active' if request.path == root_url %>">
            <a href="<%= root_url %>"><%= t 'nav.all', 'All translations' %></a></li>
          <li class="<%= 'active' if request.path == my_url %>">
            <a href="<%= my_url %>"><%= t 'nav.my', 'My translations' %></a></li>
          <li class="<%= 'active' if request.path == default_url %>">
            <a href="<%= default_url %>"><%= t 'nav.default', 'Default translations' %></a></li>
        </ul>
      </div>
    </div>

    <!-- Form for posting new and changing existing translations. -->
    <form action="<%= set_url %>" method="post" class="form-horizontal well">
      <select name="k" data-chosen="chosen" data-for="textarea[name=v]"
          data-placeholder="<%= t 'form.select.placeholder', 'en.greeting' %>">
        <option></option>
        <% @translations.each do |k, v| %>
          <%= content_tag :option, k, value: k, data: { v: v } %>
        <% end %>
      </select>
      <button type="submit" class="btn btn-success"><%= t 'form.button', 'Change' %></button><br />
      <textarea name="v" type="text"
          placeholder="<%= t 'form.textarea.placeholder', 'Hello World!' %>"></textarea>
    </form>

    <!-- Flash notifications. -->
    <% [:flash_success, :flash_error].each do |k| %>
      <% if v = session.delete(k) %>
        <div class="alert alert-<%= k.to_s.gsub 'flash_', '' %>"><%= v %></div>
      <% end %>
    <% end %>

    <!-- List of translations. -->
    <% if @translations.any? %>
      <table class="table table-striped">
        <tr>
          <th><%= t 'table.header.path', 'Path' %></th>
          <th><%= t 'table.header.translation', 'Translation' %></th>
          <th><%= t 'table.header.actions', 'Actions' %></th>
        </tr>
        <% @translations.each_pair do |k, v| %>
          <tr>
            <% if v.kind_of? Riddick::Backends::KeyValue::Value %>
              <!-- Details for custom translation. -->
              <td><span class="badge badge-success"><%= k %></span></td>
              <td>
                <code>
                  <%= link_to truncate(v), '#', rel: 'popover', onclick: 'javascript:void(0);', data: { title: t('table.popover.my', 'My translation'), content: v, trigger: 'hover' } %>
                </code>
              </td>
              <td>
                <%= link_to t('table.edit.my', 'Edit'), '#custom-translations', class: 'btn btn-mini', data: { choose: k, v: v } %>
                <a href="<%= del_url k %>" data-confirm="<%= t 'table.confirm', 'Are you sure?' %>"
                  class="btn btn-mini btn-danger"><%= t 'table.delete', 'Delete' %></a>
              </td>
            <% else %>
              <!-- Details for default translation. -->
              <td><span class="badge"><%= k %></span></td>
              <td>
                <code>
                  <%= link_to truncate(v), '#', onclick: 'javascript:void(0);', rel: 'popover', data: { title: t('table.popover.default', 'Default translation'), content: v, trigger: 'hover' } %>
                </code>
              </td>
              <td>
                <%= link_to t('table.edit.default', 'Edit'), '#custom-translations', class: 'btn btn-mini', data: { choose: k, v: v } %>
              </td>
            <% end %>
          </tr>
        <% end %>
      </table>
    <% else %>
      <div class="alert alert-info"><%= t 'notice.empty', 'You have no translations yet.' %></div>
    <% end %>

    <div class="well"><a href="https://github.com/kostia/riddick">https://github.com/kostia/riddick</a></div>
  </div>

  <script src="<%= url 'javascripts/vendor/jquery.js' %>" type="text/javascript"></script>
  <script src="<%= url 'javascripts/vendor/chosen.js' %>" type="text/javascript"></script>
  <script src="<%= url 'javascripts/vendor/bootstrap.js' %>" type="text/javascript"></script>
  <script src="<%= url 'javascripts/riddick.js' %>" type="text/javascript"></script>
</body>
</html>
